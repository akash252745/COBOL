name: Compile and Run COBOL Program - Filecompr

on:
  workflow_dispatch:     # allows manual run from GitHub Actions tab
  push:
    paths:
      - 'Filecompr.cob'  # optional: auto-run when COBOL File changes

jobs:
  run-cobol:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install GnuCOBOL compiler
        run: |
          sudo apt-get update
          sudo apt-get install -y gnucobol

      - name: Verify COBOL and input Files
        run: |
          echo "Listing repositoryFiles:"
          ls -l
          echo ""
          echo "Hostname: $(hostname), Path: $(pwd)" $HOME
          echo ""
          echo "Verifying COBOL and input Files exist:"
          if [ -f "Filecompr.cob" ]; then echo "Filecompr.cob found"; else echo " COBOL File missing"; fi
          if [ -f "File1.txt" ]; then echo "File1.txt found"; else echo " File1.txt missing"; fi
          if [ -f "File2.txt" ]; then echo "File2.txt found"; else echo " File2.txt missing"; fi

      - name: Compile COBOL program
        run: |
          echo "Compiling Filecompr.cob..."
          cobc -x Filecompr.cob -o Filecompr.exe
          echo "Compilation complete"
          ls -l Filecompr

      - name: Run COBOL program
        run: |
          echo "Executing COBOL program..."
          ./Filecompr
          echo "Execution complete"

      - name: Display output Files
        run: |
          echo ""
          echo "---- Output Files Generated ----"
          ls -l File3.txt File4.txt File5.txt || echo "Some output Files may be missing."
          echo ""
          for f in File3.txt File4.txt File5.txt; do
            if [ -f "$f" ]; then
              echo "===== Contents of $f ====="
              cat "$f"
              echo ""
            else
              echo "  $f not created"
            fi
          done
