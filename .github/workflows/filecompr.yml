name: Compile and Run COBOL Program - FILECOMPR

on:
  workflow_dispatch:     # allows manual run from GitHub Actions tab
  push:
    paths:
      - 'filecompr.cob'  # optional: auto-run when COBOL file changes

jobs:
  run-cobol:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install GnuCOBOL compiler
        run: |
          sudo apt-get update
          sudo apt-get install -y gnucobol

      - name: Verify COBOL and input files
        run: |
          echo "Listing repository files:"
          ls -l
          echo ""
          echo "Verifying COBOL and input files exist:"
          if [ -f "filecompr.cob" ]; then echo "✅ filecompr.cob found"; else echo "❌ COBOL file missing"; fi
          if [ -f "file1.txt" ]; then echo "✅ file1.txt found"; else echo "❌ file1.txt missing"; fi
          if [ -f "file2.txt" ]; then echo "✅ file2.txt found"; else echo "❌ file2.txt missing"; fi

      - name: Compile COBOL program
        run: |
          echo "Compiling filecompr.cob..."
          cobc -x filecompr.cob -o filecompr.exe
          echo "✅ Compilation complete"
          ls -l filecompr

      - name: Run COBOL program
        run: |
          echo "Executing COBOL program..."
          ./filecompr
          echo "✅ Execution complete"

      - name: Display output files
        run: |
          echo ""
          echo "---- Output Files Generated ----"
          ls -l file3.txt file4.txt file5.txt || echo "Some output files may be missing."
          echo ""
          for f in file3.txt file4.txt file5.txt; do
            if [ -f "$f" ]; then
              echo "===== Contents of $f ====="
              cat "$f"
              echo ""
            else
              echo "⚠️  $f not created"
            fi
          done
